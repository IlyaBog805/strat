# IDEF0-схема процесса "Формирование планов и рефлексий"

## A-0: Контекстная диаграмма (Верхний уровень)

Эта диаграмма описывает высокоуровневую архитектуру системы "Архитектура Осмысленной Жизни 3.0", показывая ключевые входы, выходы, элементы управления и механизмы как единый процесс.

```mermaid
graph TD
    subgraph IDEF0_Context_Diagram [A-0: Обработка сессии пользователя]
        %% Controls (Управление - сверху)
        C1["Методология АОЖ 3.0"]
        C2["Системный промпт<br/>для AI-коуча"]
        
        %% Main Process (Основной процесс - в центре)
        P["<div style='font-size:1.2em; font-weight:bold; padding: 10px;'>Обработка сессии<br/>пользователя</div>"]

        %% Inputs (Входы - слева)
        I1["Текстовые и голосовые<br/>сообщения пользователя"]
        I2["Данные о пользователе<br/>(ID, имя, прогресс)"]

        %% Outputs (Выходы - справа)
        O1["Ответ пользователю<br/>в Telegram"]
        O2["Обновленный план<br/>и рефлексия в БД"]
        O3["Запись диалога<br/>в лог и память"]

        %% Mechanisms (Механизмы - снизу)
        M1["<b>AI-коуч:</b><br/>Mistral Cloud"]
        M2["<b>Платформа автоматизации:</b><br/>n8n"]
        M3["<b>База данных / Память:</b><br/>Supabase (Postgres)"]
        M4["<b>Транскрибация голоса:</b><br/>Nexara"]

        %% Connections
        C1 -- Управление --> P
        C2 -- Управление --> P
        
        I1 -- Вход --> P
        I2 -- Вход --> P
        
        P -- Выход --> O1
        P -- Выход --> O2
        P -- Выход --> O3
        
        P -- "Исполняется с помощью" --> M1
        P -- "Исполняется с помощью" --> M2
        P -- "Исполняется с помощью" --> M3
        P -- "Исполняется с помощью" --> M4

    end

    %% Styling
    style P fill:#f9f,stroke:#333,stroke-width:2px,height:120px
    style I1,I2 fill:#ccf,stroke:#333,stroke-width:1px
    style O1,O2,O3 fill:#cfc,stroke:#333,stroke-width:1px
    style C1,C2 fill:#fcc,stroke:#333,stroke-width:1px
    style M1,M2,M3,M4 fill:#e8e8e8,stroke:#333,stroke-width:1px
```

---

## A0: Декомпозиция процесса "Обработка сессии"

Эта диаграмма детализирует центральный блок `Обработка сессии пользователя` и показывает ключевые этапы, основанные на документе `AOJ3.md`.

```mermaid
graph TD
    subgraph A0_Decomposition [A0: Этапы сессии "Пре-сессия / Знакомство"]

        %% Process Blocks from AOJ3.md
        A1["<b>A1: Приветствие<br/>и Настройка</b>"]
        A2["<b>A2: Диагностика</b><br/>(вопросы о настроении,<br/>энергии, вызовах и т.д.)"]
        A3["<b>A3: Синтез<br/>и Завершение</b>"]

        %% Connections
        A1 -- "Начало диалога" --> A2
        A2 -- "Ответы пользователя" --> A3

        %% Inputs
        I1["Сообщения и данные<br/>пользователя"]
        I1 -- Вход --> A1
        I1 -- "Поток ответов" --> A2
        
        %% Outputs
        O1["Эмпатичные ответы<br/>и следующие вопросы"]
        O2["Итоговый синтез в БД<br/>и ответ пользователю"]
        
        A2 -- Выход --> O1
        A3 -- Выход --> O2

        %% Controls
        C1["Методология из AOJ3.md"]
        C1 -- Управляет --> A1
        C1 -- Управляет --> A2
        C1 -- Управляет --> A3
        
        %% Mechanisms
        M_All["<div style='text-align:center'><b>Общие механизмы:</b><br/>AI-коуч (Mistral), n8n, Supabase, Nexara</div>"]
        M_All -- "Используются<br/>на каждом этапе" --> A1
        M_All -- "Используются<br/>на каждом этапе" --> A2
        M_All -- "Используются<br/>на каждом этапе" --> A3
        
    end
    
    %% Styling
    style A1,A2,A3 fill:#f9f,stroke:#333,stroke-width:2px
    style I1 fill:#ccf,stroke:#333,stroke-width:1px
    style O1,O2 fill:#cfc,stroke:#333,stroke-width:1px
    style C1 fill:#fcc,stroke:#333,stroke-width:1px
    style M_All fill:#e8e8e8,stroke:#333,stroke-width:1px
```

## Компоненты диаграммы

### Входы (Inputs)
- **Сообщения пользователя:** Текст или голос, который отправляет пользователь.
- **Данные о пользователе:** Информация из базы данных (ID, имя, текущий прогресс в сессии).

### Выходы (Outputs)
- **Ответ пользователю в Telegram:** Сгенерированное AI-коучем сообщение.
- **Обновленный план и рефлексия в БД:** Структурированные результаты сессии, сохраненные в Supabase.
- **Запись диалога в лог и память:** Сохранение истории сообщений для контекста и анализа.

### Управление (Controls)
- **Методология АОЖ 3.0:** Принципы и структура коучинговой сессии.
- **Системный промпт для AI-коуча:** Конкретные инструкции, которые определяют поведение AI.

### Механизмы (Mechanisms)
- **AI-коуч (Mistral Cloud):** Языковая модель, генерирующая ответы.
- **Платформа автоматизации (n8n):** Система, управляющая всем процессом.
- **База данных / Память (Supabase):** Хранилище для всех данных пользователя.
- **Транскрибация голоса (Nexara):** Сервис для преобразования голоса в текст. 